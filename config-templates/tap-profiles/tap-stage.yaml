#@ load("@ytt:data", "data")
---
profile: build
shared:
  ingress_issuer: #@ data.values.tap.ingressIssuer
  image_registry:
    project_path: #@ "{}/{}".format(data.values.private_registry.host, data.values.private_registry.repo)
    username: #@ data.values.private_registry.username
    password: #@ data.values.private_registry.password
    
supply_chain: testing_scanning

ootb_supply_chain_testing_scanning:
  gitops:
    server_address: #@ data.values.deliverable_gitops.server_address
    repository_owner: #@ data.values.deliverable_gitops.repository_owner
    repository_name: #@ data.values.deliverable_gitops.repository_name

namespace_provisioner:
  controller: true
  additional_sources:
  - git:
      ref: origin/main
      subPath: resources
      url: https://github.com/dektlong/dekt-gitops.git
    path: _ytt_lib/resources
  overlay_secrets:
  - name: git-creds-sa-overlay
    namespace: tap-install
    create_export: true


grype:
  namespace: "" 
  metadataStore:
    url: #@ "{}.{}.{}".format("https://metadata-store", data.values.dns.sysSubDomain, data.values.dns.domain)
    caSecret:
        name: store-ca-cert
        importFromNamespace: metadata-store-secrets
    authSecret:
        name: store-auth-token
        importFromNamespace: metadata-store-secrets
scanning:
  metadataStore: {} 

ceip_policy_disclosed: true
excluded_packages:
- learningcenter.tanzu.vmware.com
- workshops.learningcenter.tanzu.vmware.com
- tap-telemetry.tanzu.vmware.com 
